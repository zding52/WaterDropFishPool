{% load static %}

<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  	<title>P3 Coloring</title>

	<script type="text/javascript" src="{% static 'coloring/vendors/jquery/jquery-3.3.1.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'coloring/vendors/paper/paper-full.min.js' %}"></script>
  <script type= "text/javascript"src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.2/TweenMax.min.js"></script>
	<style type="text/css">
    
    canvas { display: block; cursor: pointer; } 
    html { height: 100%; overflow: hidden; }
		#color-palette {
			width: 300px;
			background-color: #f1f1f1;
			display: flex;
			flex-wrap: wrap;
			position: absolute;
			top: 0;
		}

		.swatch {
			width: 24px;
			height: 24px;
			-moz-border-radius: 12px;
			-webkit-border-radius: 12px;
			border-radius: 12px;
			margin: 3px;
		}

/* 		#myCanvas {
			padding-left: 0;
		    padding-right: 0;
		    margin-left: auto;
		    margin-right: auto;
		    display: block;
		} */
    
	</style>

<!--   <script type = "text/javascript" src = "https://codepen.io/shshaw/pen/epmrgO"></script> -->
  <script type = "text/javascript" src = "https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.2/TweenMax.min.js"></script>
  <script type = "text/javascript">
     
    $(document).ready(function() {

      console.clear();

var twoPI = 2 * Math.PI;

var canvas = document.createElement('canvas'),
    ctx = canvas.getContext('2d');


var width = canvas.width = window.innerWidth,
    height = canvas.height = window.innerHeight;

window.addEventListener('resize',function(){
  width = canvas.width = window.innerWidth;
  height = canvas.height = window.innerHeight;
});

document.body.appendChild(canvas);

/* ///////////////////////////////////////// */

function randomWiggle(wiggle) {
  return ( Math.random() * wiggle ) * ( Math.random() < 0.5 ? -1 : 1 )
}


var color = -25;
function randomColor(){
  color = Math.floor( ( color % 360 ) + 25 + 15 * Math.random() );
  return 'hsl(' + color + ', 50%, 55%)';
}


/* //////////////////////////////////////// */

function WaterColor(options) {
  if (!(this instanceof WaterColor)) { return new WaterColor(options); }

  for (var key in options) {
    if (options.hasOwnProperty(key)) { this[key] = options[key]; }
  }

  if ( !this.fill ) { this.fill = randomColor(); }
  this.c = Math.floor( Math.random() * 2 );
  this.render();
}

WaterColor.prototype = {
  sides: 6,
  x: 20,
  y: 20,
  ctx: false,

  speed: 0.3,

  maxPoints: 3000,
  maxRender: 5,
  
  scale: false,

  buildPoints(){

    var wiggle = this.size * 0.15,
        rotation = 0,
        x = -this.size, 
        y = 0,
        horizontal = Math.random() > 0.5,
        start = [ x, y ];

    this.points = [ start ];

    for (; rotation < twoPI; rotation += this.speed) {

      x += 
        this.size 
        * this.speed
        * Math.sin(rotation)
        * ( horizontal ? 1 : 0.7 )
        + randomWiggle( wiggle ); // * Math.cos( (rotation/twoPI) * twoPI ) );

      y += 
        this.size
        * this.speed
        * Math.cos(rotation)
        * ( horizontal ? 0.7 : 1 )
        + randomWiggle( wiggle );// * Math.cos( (rotation/twoPI) * twoPI) );

      this.points.push([ x, y ]);
    }
    
    
    this.points.push( start );

    this.originalPoints = this.points;
    return this.points;
  },

  expandPoints(){

    if ( !this.points ) { return this.buildPoints(); }

    if ( this.points.length > this.maxPoints ) { return false; }

    var wiggle = this.size * 0.05;

    var p = [],
        i = 0,
        len = this.points.length - 1,
        x, y, x2, y2;

    for ( ; i < len; i++) {
      y = this.points[i][1];
      x = this.points[i][0];
      y2 = this.points[i + 1][1];
      x2 = this.points[i + 1][0];
      p.push(
        [x, y],
        [
          (( x2 + x )/2) + randomWiggle(wiggle),  
          (( y2 + y )/2) + randomWiggle(wiggle)
        ],
        [x2, y2]
      );
    }

    this.points = p;

    return true;

  },

  c: 0,

  render: function(){
    this.c++;
    if ( this.c < (this.maxRender * 3) ) { requestAnimationFrame(this.render.bind(this)); }
    if ( this.c % 3 == 0 ) { this.draw(this.c / 3); }
  },

  draw: function(c) {

    if (this.ctx) {

      while ( this.expandPoints() ){}

      var ctx = this.ctx;
      
      var itr = (c/this.maxRender);
      
      ctx.setTransform(1, 0, 0, 1, 0, 0);

      ctx.globalCompositeOperation = 'hard-light';// 'xor';
      ctx.globalAlpha = 0.25 - ( itr * 0.1 );

      ctx.translate( this.x, this.y );
      if ( this.scale ) { ctx.scale( 1 + itr * 0.2, 1 + itr * 0.2 ); }
      
      ctx.beginPath();
      ctx.moveTo(this.points[0][0], this.points[0][1]); //this.x + this.size, this.y);

      for (var i = 0, len = this.points.length; i < len; i++) {
        ctx.lineTo( this.points[i][0], this.points[i][1] );
      }

      ctx.closePath();
      ctx.fillStyle = this.fill;
      ctx.fill();

      this.points = this.originalPoints;

    }

    return this;
  }
};



var color = 0;
function makeWatercolor(e){

  var x = width * Math.random(),
      y = height * Math.random();

  if ( e ) {
    e = e.touches ? e.touches[0] : e;
    x = e.clientX || e.x;
    y = e.clientY || e.y;
  }

  ctx.globalAlpha = 0.02;
  ctx.setTransform(1, 0, 0, 1, 0, 0);
  ctx.fillStyle = '#FFF';
  ctx.fillRect(0, 0, width, height);

  new WaterColor({
    ctx: ctx,
    size: Math.min(width,height) * ( 0.2 + Math.random() * 0.1 ),
    x: x,
    y: y,
    scale: true
  })

}


document.addEventListener('click', makeWatercolor );
// document.addEventListener('touchstart', makeWatercolor );


/* ////////////////////////////////////////////////////////////////////////// */


var halfWidth = width / 2,
    halfHeight = height / 2

for (var i = 0, len = 10; i < len; i++ ){

  new WaterColor({
    ctx: ctx,
    size: width * ( 0.7 + Math.random() * 0.1 ),
    x: halfWidth + ( Math.cos( (i / len) * twoPI ) * halfWidth ), 
    y: halfHeight + ( Math.sin( (i / len) * twoPI ) * halfHeight ) 
  });

}

/* */
    });
  </script>
  
<!-- 	<script type="text/javascript" canvas="canvas">
    
		window.onload = function() {
			var canvas = document.getElementById('myCanvas');

			// coloring page
			var mandala = {
				item: null,
				lastClicked: null,
				filePath: '/static/coloring/images/mandala-freepik.svg'
			};	

			// color palette
			var cp = {
				history: ["#000000"], // black selected by default
				options: [],
				$container: $('#color-palette')
			}

			// your rectangle gradient interaction goes in this function
			// you may also add code outside of the function (e.g., global variables)
			function myGradientInteraction(){
// 				var tool = new paper.Tool();

// 				tool.onMouseDown = function (event) {

// 				}

// 				tool.onMouseUp = function (event) {
					
// 				}
			}

			// your custom interaction goes here!
			// you may replace everything
			function myCustomInteraction() {
        var path;
				var tool = new paper.Tool();
        tool.minDistance = 0.1;
				tool.onMouseDown = function (event) {
// 				    var hit = mandala.item.hitTest(event.point, { tolerance: 10, fill: true });
// 				    if (hit) {
// 				        hit.item.fillColor = cp.history[cp.history.length - 1];
// 				    }
// 				}
         path = new paper.Path();
         path.strokeColor = cp.history[cp.history.length - 1];
         path.add(event.point);
			}
        tool.onMouseDrag = function(event){
          path.add(event.point);
          path.smooth();
        }
//         tool.onMouseUp = function(event){
//           path.add(event.point);
//           path.closed = true;
//           path.smooth();
//         }
        
      }

			// create a color palette with the given colors
			function createColorPalette(colors){

				// create a swatch for each color
				for (var i = colors.length - 1; i >= 0; i--) {
					var $swatch = $("<div>").css("background-color", colors[i])
									   .addClass("swatch");
					$swatch.click(function(){
						// add color to the color palette history
					  	cp.history.push($(this).css("background-color"));
					});
					cp.$container.append($swatch);
				}
			}

			// loads a set of colors from a json to create a color palette
			function getColorsCreatePalette(){
				cp.$container.html(" ");
				$.getJSON('/static/coloring/vendors/material/material-colors.json', function(colors){
					var keys = Object.keys(colors);
					for (var i = keys.length - 1; i >= 0; i--) {
						cp.options.push(colors[keys[i]][500]);
					}
					createColorPalette(cp.options);
				});
			}

			function init(custom){
				paper.setup(canvas);
				getColorsCreatePalette();

				paper.project.importSVG(mandala.filePath, function(item) { 
					mandala.item = item._children["design-freepik"];
				    paper.project.insertLayer(0,mandala.item);

				    if (custom) {
				    	myCustomInteraction();	
				    } else {
				    	myGradientInteraction();
				    }		
					
				}); 
			}

			// To see your myGradientInteraction version visit: 
			// http://<your url>:8000/coloring/?type=gradient
			// To see your myCustomInteraction version visit: 
			// http://<your url>:8000/coloring/
			var url = window.location.href;
			if (url.indexOf("gradient") > -1) {
				init(false);
			} else {
				init(true);
			}
		}
	</script> -->
  
</head>
<body width = "200px" heigth="500px">	

<!-- 	<canvas id="myCanvas" width="750px" height="750px"></canvas> -->
	<div id="color-palette"></div>
</body>
</html>